(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[856,154],{7906:function(e,t,n){"use strict";let a;n.d(t,{qA:function(){return Environment}});var i=n(3428),o=n(2265),s=n(5362),l=n(2461);let u=parseInt(l.UZH.replace(/\D+/g,"")),isCubeTexture=e=>e&&e.isCubeTexture;let GroundProjectedEnv=class GroundProjectedEnv extends l.Kj0{constructor(e,t){var n,a;let i=isCubeTexture(e),o=null!=(a=i?null==(n=e.image[0])?void 0:n.width:e.image.width)?a:1024,s=Math.floor(Math.log2(o/4)),d=Math.pow(2,s),c=[i?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(d,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*d)}`,`#define CUBEUV_MAX_MIP ${s}.0`],f=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,p=c.join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${u>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,h={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}},m=new l.cJO(1,16),y=new l.jyz({uniforms:h,fragmentShader:p,vertexShader:f,side:l.ehD});super(m,y)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}};let RGBELoader=class RGBELoader extends l.yxD{constructor(e){super(e),this.type=l.cLu}parse(e){let t,n,a;let rgbe_error=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},fgets=function(e,t,n){t=t||1024;let a=e.pos,i=-1,o=0,s="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));for(;0>(i=l.indexOf("\n"))&&o<t&&a<e.byteLength;)s+=l,o+=l.length,a+=128,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return -1<i&&(!1!==n&&(e.pos+=o+i+1),s+l.slice(0,i))},i=new Uint8Array(e);i.pos=0;let o=function(e){let t,n;let a=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,s=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=fgets(e))||rgbe_error(1,"no header found"),(n=t.match(/^#\?(\S+)/))||rgbe_error(3,"bad initial token"),l.valid|=1,l.programtype=n[1],l.string+=t+"\n";!1!==(t=fgets(e));){if(l.string+=t+"\n","#"===t.charAt(0)){l.comments+=t+"\n";continue}if((n=t.match(a))&&(l.gamma=parseFloat(n[1])),(n=t.match(i))&&(l.exposure=parseFloat(n[1])),(n=t.match(o))&&(l.valid|=2,l.format=n[1]),(n=t.match(s))&&(l.valid|=4,l.height=parseInt(n[1],10),l.width=parseInt(n[2],10)),2&l.valid&&4&l.valid)break}return 2&l.valid||rgbe_error(3,"missing format specifier"),4&l.valid||rgbe_error(3,"missing image size specifier"),l}(i),s=o.width,u=o.height,d=function(e,t,n){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&rgbe_error(3,"wrong scanline width");let a=new Uint8Array(4*t*n);a.length||rgbe_error(4,"unable to allocate buffer space");let i=0,o=0,s=4*t,l=new Uint8Array(4),u=new Uint8Array(s),d=n;for(;d>0&&o<e.byteLength;){o+4>e.byteLength&&rgbe_error(1),l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&rgbe_error(3,"bad rgbe scanline format");let n=0,c;for(;n<s&&o<e.byteLength;){c=e[o++];let t=c>128;if(t&&(c-=128),(0===c||n+c>s)&&rgbe_error(3,"bad scanline data"),t){let t=e[o++];for(let e=0;e<c;e++)u[n++]=t}else u.set(e.subarray(o,o+c),n),n+=c,o+=c}for(let e=0;e<t;e++){let n=0;a[i]=u[e+n],n+=t,a[i+1]=u[e+n],n+=t,a[i+2]=u[e+n],n+=t,a[i+3]=u[e+n],i+=4}d--}return a}(i.subarray(i.pos),s,u);switch(this.type){case l.VzW:a=d.length/4;let c=new Float32Array(4*a);for(let e=0;e<a;e++)!function(e,t,n,a){let i=e[t+3],o=Math.pow(2,i-128)/255;n[a+0]=e[t+0]*o,n[a+1]=e[t+1]*o,n[a+2]=e[t+2]*o,n[a+3]=1}(d,4*e,c,4*e);t=c,n=l.VzW;break;case l.cLu:a=d.length/4;let f=new Uint16Array(4*a);for(let e=0;e<a;e++)!function(e,t,n,a){let i=e[t+3],o=Math.pow(2,i-128)/255;n[a+0]=l.A5E.toHalfFloat(Math.min(e[t+0]*o,65504)),n[a+1]=l.A5E.toHalfFloat(Math.min(e[t+1]*o,65504)),n[a+2]=l.A5E.toHalfFloat(Math.min(e[t+2]*o,65504)),n[a+3]=l.A5E.toHalfFloat(1)}(d,4*e,f,4*e);t=f,n=l.cLu;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:s,height:u,data:t,header:o.string,gamma:o.gamma,exposure:o.exposure,type:n}}setDataType(e){return this.type=e,this}load(e,t,n,a){return super.load(e,function(e,n){switch(e.type){case l.VzW:case l.cLu:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=l.wem,e.magFilter=l.wem,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,n)},n,a)}};var d={},c=Uint8Array,f=Uint16Array,p=Uint32Array,h=new c([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),m=new c([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),y=new c([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(e,t){for(var n=new f(31),a=0;a<31;++a)n[a]=t+=1<<e[a-1];for(var i=new p(n[30]),a=1;a<30;++a)for(var o=n[a];o<n[a+1];++o)i[o]=o-n[a]<<5|a;return[n,i]},M=freb(h,2),x=M[0],F=M[1];x[28]=258,F[258]=28;for(var _=freb(m,0),S=_[0],C=_[1],R=new f(32768),A=0;A<32768;++A){var U=(43690&A)>>>1|(21845&A)<<1;U=(61680&(U=(52428&U)>>>2|(13107&U)<<2))>>>4|(3855&U)<<4,R[A]=((65280&U)>>>8|(255&U)<<8)>>>1}for(var hMap=function(e,t,n){for(var a,i=e.length,o=0,s=new f(t);o<i;++o)++s[e[o]-1];var l=new f(t);for(o=0;o<t;++o)l[o]=l[o-1]+s[o-1]<<1;if(n){a=new f(1<<t);var u=15-t;for(o=0;o<i;++o)if(e[o])for(var d=o<<4|e[o],c=t-e[o],p=l[e[o]-1]++<<c,h=p|(1<<c)-1;p<=h;++p)a[R[p]>>>u]=d}else for(o=0,a=new f(i);o<i;++o)e[o]&&(a[o]=R[l[e[o]-1]++]>>>15-e[o]);return a},P=new c(288),A=0;A<144;++A)P[A]=8;for(var A=144;A<256;++A)P[A]=9;for(var A=256;A<280;++A)P[A]=7;for(var A=280;A<288;++A)P[A]=8;for(var I=new c(32),A=0;A<32;++A)I[A]=5;var T=hMap(P,9,1),k=hMap(I,5,1),max=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},bits=function(e,t,n){var a=t/8|0;return(e[a]|e[a+1]<<8)>>(7&t)&n},bits16=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},shft=function(e){return(e/8|0)+(7&e&&1)},slc=function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var a=new(e instanceof f?f:e instanceof p?p:c)(n-t);return a.set(e.subarray(t,n)),a},inflt=function(e,t,n){var a=e.length;if(!a||n&&!n.l&&a<5)return t||new c(0);var i=!t||n,o=!n||n.i;n||(n={}),t||(t=new c(3*a));var cbuf=function(e){var n=t.length;if(e>n){var a=new c(Math.max(2*n,e));a.set(t),t=a}},s=n.f||0,l=n.p||0,u=n.b||0,d=n.l,f=n.d,p=n.m,M=n.n,F=8*a;do{if(!d){n.f=s=bits(e,l,1);var _=bits(e,l+1,3);if(l+=3,_){if(1==_)d=T,f=k,p=9,M=5;else if(2==_){var C=bits(e,l,31)+257,R=bits(e,l+10,15)+4,A=C+bits(e,l+5,31)+1;l+=14;for(var U=new c(A),P=new c(19),I=0;I<R;++I)P[y[I]]=bits(e,l+3*I,7);l+=3*R;for(var L=max(P),O=(1<<L)-1,z=hMap(P,L,1),I=0;I<A;){var B=z[bits(e,l,O)];l+=15&B;var H=B>>>4;if(H<16)U[I++]=H;else{var N=0,j=0;for(16==H?(j=3+bits(e,l,3),l+=2,N=U[I-1]):17==H?(j=3+bits(e,l,7),l+=3):18==H&&(j=11+bits(e,l,127),l+=7);j--;)U[I++]=N}}var W=U.subarray(0,C),G=U.subarray(C);p=max(W),M=max(G),d=hMap(W,p,1),f=hMap(G,M,1)}else throw"invalid block type"}else{var H=shft(l)+4,V=e[H-4]|e[H-3]<<8,X=H+V;if(X>a){if(o)throw"unexpected EOF";break}i&&cbuf(u+V),t.set(e.subarray(H,X),u),n.b=u+=V,n.p=l=8*X;continue}if(l>F){if(o)throw"unexpected EOF";break}}i&&cbuf(u+131072);for(var Z=(1<<p)-1,$=(1<<M)-1,q=l;;q=l){var N=d[bits16(e,l)&Z],Y=N>>>4;if((l+=15&N)>F){if(o)throw"unexpected EOF";break}if(!N)throw"invalid length/literal";if(Y<256)t[u++]=Y;else if(256==Y){q=l,d=null;break}else{var Q=Y-254;if(Y>264){var I=Y-257,J=h[I];Q=bits(e,l,(1<<J)-1)+x[I],l+=J}var K=f[bits16(e,l)&$],ee=K>>>4;if(!K)throw"invalid distance";l+=15&K;var G=S[ee];if(ee>3){var J=m[ee];G+=bits16(e,l)&(1<<J)-1,l+=J}if(l>F){if(o)throw"unexpected EOF";break}i&&cbuf(u+131072);for(var er=u+Q;u<er;u+=4)t[u]=t[u-G],t[u+1]=t[u+1-G],t[u+2]=t[u+2-G],t[u+3]=t[u+3-G];u=er}}n.l=d,n.p=q,n.b=u,d&&(s=1,n.m=p,n.d=f,n.n=M)}while(!s);return u==t.length?t:slc(t,0,u)},wbits=function(e,t,n){n<<=7&t;var a=t/8|0;e[a]|=n,e[a+1]|=n>>>8},wbits16=function(e,t,n){n<<=7&t;var a=t/8|0;e[a]|=n,e[a+1]|=n>>>8,e[a+2]|=n>>>16},hTree=function(e,t){for(var n=[],a=0;a<e.length;++a)e[a]&&n.push({s:a,f:e[a]});var i=n.length,o=n.slice();if(!i)return[O,0];if(1==i){var s=new c(n[0].s+1);return s[n[0].s]=1,[s,1]}n.sort(function(e,t){return e.f-t.f}),n.push({s:-1,f:25001});var l=n[0],u=n[1],d=0,p=1,h=2;for(n[0]={s:-1,f:l.f+u.f,l:l,r:u};p!=i-1;)l=n[n[d].f<n[h].f?d++:h++],u=n[d!=p&&n[d].f<n[h].f?d++:h++],n[p++]={s:-1,f:l.f+u.f,l:l,r:u};for(var m=o[0].s,a=1;a<i;++a)o[a].s>m&&(m=o[a].s);var y=new f(m+1),M=ln(n[p-1],y,0);if(M>t){var a=0,x=0,F=M-t,_=1<<F;for(o.sort(function(e,t){return y[t.s]-y[e.s]||e.f-t.f});a<i;++a){var S=o[a].s;if(y[S]>t)x+=_-(1<<M-y[S]),y[S]=t;else break}for(x>>>=F;x>0;){var C=o[a].s;y[C]<t?x-=1<<t-y[C]++-1:++a}for(;a>=0&&x;--a){var R=o[a].s;y[R]==t&&(--y[R],++x)}M=t}return[new c(y),M]},ln=function(e,t,n){return -1==e.s?Math.max(ln(e.l,t,n+1),ln(e.r,t,n+1)):t[e.s]=n},lc=function(e){for(var t=e.length;t&&!e[--t];);for(var n=new f(++t),a=0,i=e[0],o=1,w=function(e){n[a++]=e},s=1;s<=t;++s)if(e[s]==i&&s!=t)++o;else{if(!i&&o>2){for(;o>138;o-=138)w(32754);o>2&&(w(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(w(i),--o;o>6;o-=6)w(8304);o>2&&(w(o-3<<5|8208),o=0)}for(;o--;)w(i);o=1,i=e[s]}return[n.subarray(0,a),t]},clen=function(e,t){for(var n=0,a=0;a<t.length;++a)n+=e[a]*t[a];return n},wfblk=function(e,t,n){var a=n.length,i=shft(t+2);e[i]=255&a,e[i+1]=a>>>8,e[i+2]=255^e[i],e[i+3]=255^e[i+1];for(var o=0;o<a;++o)e[i+o+4]=n[o];return(i+4+a)*8},wblk=function(e,t,n,a,i,o,s,l,u,d,c){wbits(t,c++,n),++i[256];for(var p,M,x,F,_=hTree(i,15),S=_[0],C=_[1],R=hTree(o,15),A=R[0],U=R[1],T=lc(S),k=T[0],L=T[1],O=lc(A),z=O[0],B=O[1],H=new f(19),N=0;N<k.length;++N)H[31&k[N]]++;for(var N=0;N<z.length;++N)H[31&z[N]]++;for(var j=hTree(H,7),W=j[0],G=j[1],V=19;V>4&&!W[y[V-1]];--V);var X=d+5<<3,Z=clen(i,P)+clen(o,I)+s,$=clen(i,S)+clen(o,A)+s+14+3*V+clen(H,W)+(2*H[16]+3*H[17]+7*H[18]);if(X<=Z&&X<=$)return wfblk(t,c,e.subarray(u,u+d));if(wbits(t,c,1+($<Z)),c+=2,$<Z){p=hMap(S,C,0),M=S,x=hMap(A,U,0),F=A;var q=hMap(W,G,0);wbits(t,c,L-257),wbits(t,c+5,B-1),wbits(t,c+10,V-4),c+=14;for(var N=0;N<V;++N)wbits(t,c+3*N,W[y[N]]);c+=3*V;for(var Y=[k,z],Q=0;Q<2;++Q)for(var J=Y[Q],N=0;N<J.length;++N){var K=31&J[N];wbits(t,c,q[K]),c+=W[K],K>15&&(wbits(t,c,J[N]>>>5&127),c+=J[N]>>>12)}}else p=null,M=P,x=null,F=I;for(var N=0;N<l;++N)if(a[N]>255){var K=a[N]>>>18&31;wbits16(t,c,p[K+257]),c+=M[K+257],K>7&&(wbits(t,c,a[N]>>>23&31),c+=h[K]);var ee=31&a[N];wbits16(t,c,x[ee]),c+=F[ee],ee>3&&(wbits16(t,c,a[N]>>>5&8191),c+=m[ee])}else wbits16(t,c,p[a[N]]),c+=M[a[N]];return wbits16(t,c,p[256]),c+M[256]},L=new p([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),O=new c(0),zlv=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function unzlibSync(e,t){return inflt((zlv(e),e.subarray(2,-4)),t)}var z="undefined"!=typeof TextDecoder&&new TextDecoder;try{z.decode(O,{stream:!0})}catch(e){}let B=u>=152;let EXRLoader=class EXRLoader extends l.yxD{constructor(e){super(e),this.type=l.cLu}parse(e){let t={l:0,c:0,lc:0};function getBits(e,n,a,i,o){for(;a<e;)n=n<<8|parseUint8Array(i,o),a+=8;a-=e,t.l=n>>a&(1<<e)-1,t.c=n,t.lc=a}let n=Array(59),a={c:0,lc:0};function getChar(e,t,n,i){e=e<<8|parseUint8Array(n,i),t+=8,a.c=e,a.lc=t}let i={c:0,lc:0};function getCode(e,t,n,o,s,l,u,d,c,f){if(e==t){o<8&&(getChar(n,o,s,u),n=a.c,o=a.lc);var p=n>>(o-=8),p=new Uint8Array([p])[0];if(c.value+p>f)return!1;for(var h=d[c.value-1];p-- >0;)d[c.value++]=h}else{if(!(c.value<f))return!1;d[c.value++]=e}i.c=n,i.lc=o}function Int16(e){var t=65535&e;return t>32767?t-65536:t}let o={a:0,b:0};function wdec14(e,t){var n=Int16(e),a=Int16(t),i=n+(1&a)+(a>>1),s=i-a;o.a=i,o.b=s}function wdec16(e,t){var n=65535&t,a=(65535&e)-(n>>1)&65535;o.a=n+a-32768&65535,o.b=a}function hufUncompress(e,o,s,l,u,d){var c=s.value,f=parseUint32(o,s),p=parseUint32(o,s);s.value+=4;var h=parseUint32(o,s);if(s.value+=4,f<0||f>=65537||p<0||p>=65537)throw"Something wrong with HUF_ENCSIZE";var m=Array(65537),y=Array(16384);!function(e){for(var t=0;t<16384;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(y);var M=l-(s.value-c);if(!function(e,a,i,o,s,l,u){for(var d=0,c=0;s<=l;s++){if(i.value-i.value>o)return!1;getBits(6,d,c,e,i);var f=t.l;if(d=t.c,c=t.lc,u[s]=f,63==f){if(i.value-i.value>o)throw"Something wrong with hufUnpackEncTable";getBits(8,d,c,e,i);var p=t.l+6;if(d=t.c,c=t.lc,s+p>l+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[s++]=0;s--}else if(f>=59){var p=f-59+2;if(s+p>l+1)throw"Something wrong with hufUnpackEncTable";for(;p--;)u[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)n[t]=0;for(var t=0;t<65537;++t)n[e[t]]+=1;for(var a=0,t=58;t>0;--t){var i=a+n[t]>>1;n[t]=a,a=i}for(var t=0;t<65537;++t){var o=e[t];o>0&&(e[t]=o|n[o]++<<6)}}(u)}(e,0,s,M,f,p,m),h>8*(l-(s.value-c)))throw"Something wrong with hufUncompress";!function(e,t,n,a){for(;t<=n;t++){var i=e[t]>>6,o=63&e[t];if(i>>o)throw"Invalid table entry";if(o>14){var s=a[i>>o-14];if(s.len)throw"Invalid table entry";if(s.lit++,s.p){var l=s.p;s.p=Array(s.lit);for(var u=0;u<s.lit-1;++u)s.p[u]=l[u]}else s.p=[,];s.p[s.lit-1]=t}else if(o)for(var d=0,u=1<<14-o;u>0;u--){var s=a[(i<<14-o)+d];if(s.len||s.p)throw"Invalid table entry";s.len=o,s.lit=t,d++}}}(m,f,p,y),function(e,t,n,o,s,l,u,d,c,f){for(var p=0,h=0,m=Math.trunc(s.value+(l+7)/8);s.value<m;)for(getChar(p,h,n,s),p=a.c,h=a.lc;h>=14;){var y=t[p>>h-14&16383];if(y.len)h-=y.len,getCode(y.lit,u,p,h,n,o,s,c,f,d),p=i.c,h=i.lc;else{if(!y.p)throw"hufDecode issues";for(M=0;M<y.lit;M++){for(var M,x=63&e[y.p[M]];h<x&&s.value<m;)getChar(p,h,n,s),p=a.c,h=a.lc;if(h>=x&&e[y.p[M]]>>6==(p>>h-x&(1<<x)-1)){h-=x,getCode(y.p[M],u,p,h,n,o,s,c,f,d),p=i.c,h=i.lc;break}}if(M==y.lit)throw"hufDecode issues"}}var F=8-l&7;for(p>>=F,h-=F;h>0;){var y=t[p<<14-h&16383];if(y.len)h-=y.len,getCode(y.lit,u,p,h,n,o,s,c,f,d),p=i.c,h=i.lc;else throw"hufDecode issues"}}(m,y,e,o,s,h,p,d,u,{value:0})}function predictor(e){for(var t=1;t<e.length;t++){var n=e[t-1]+e[t]-128;e[t]=n}}function interleaveScalar(e,t){for(var n=0,a=Math.floor((e.length+1)/2),i=0,o=e.length-1;!(i>o)&&(t[i++]=e[n++],!(i>o));)t[i++]=e[a++]}function decodeRunLength(e){for(var t=e.byteLength,n=[],a=0,i=new DataView(e);t>0;){var o=i.getInt8(a++);if(o<0){var s=-o;t-=s+1;for(var l=0;l<s;l++)n.push(i.getUint8(a++))}else{var s=o;t-=2;for(var u=i.getUint8(a++),l=0;l<s+1;l++)n.push(u)}}return n}function uncompressRAW(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function uncompressRLE(e){var t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(decodeRunLength(t)),a=new Uint8Array(n.length);return predictor(n),interleaveScalar(n,a),new DataView(a.buffer)}function uncompressZIP(e){var t=unzlibSync(e.array.slice(e.offset.value,e.offset.value+e.size)),n=new Uint8Array(t.length);return predictor(t),interleaveScalar(t,n),new DataView(n.buffer)}function uncompressPIZ(e){for(var t=e.viewer,n={value:e.offset.value},a=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192),s=0,l=Array(e.channels),u=0;u<e.channels;u++)l[u]={},l[u].start=s,l[u].end=l[u].start,l[u].nx=e.width,l[u].ny=e.lines,l[u].size=e.type,s+=l[u].nx*l[u].ny*l[u].size;var d=parseUint16(t,n),c=parseUint16(t,n);if(c>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(d<=c)for(var u=0;u<c-d+1;u++)i[u+d]=parseUint8(t,n);var f=new Uint16Array(65536),p=function(e,t){for(var n=0,a=0;a<65536;++a)(0==a||e[a>>3]&1<<(7&a))&&(t[n++]=a);for(var i=n-1;n<65536;)t[n++]=0;return i}(i,f),h=parseUint32(t,n);hufUncompress(e.array,t,n,h,a,s);for(var u=0;u<e.channels;++u)for(var m=l[u],y=0;y<l[u].size;++y)!function(e,t,n,a,i,s,l){for(var u=l<16384,d=n>i?i:n,c=1;c<=d;)c<<=1;for(c>>=1,f=c,c>>=1;c>=1;){for(var f,p,h,m,y,M=0,x=0+s*(i-f),F=s*c,_=s*f,S=a*c,C=a*f;M<=x;M+=_){for(var R=M,A=M+a*(n-f);R<=A;R+=C){var U=R+S,P=R+F,I=P+S;u?(wdec14(e[R+t],e[P+t]),p=o.a,m=o.b,wdec14(e[U+t],e[I+t]),h=o.a,y=o.b,wdec14(p,h),e[R+t]=o.a,e[U+t]=o.b,wdec14(m,y)):(wdec16(e[R+t],e[P+t]),p=o.a,m=o.b,wdec16(e[U+t],e[I+t]),h=o.a,y=o.b,wdec16(p,h),e[R+t]=o.a,e[U+t]=o.b,wdec16(m,y)),e[P+t]=o.a,e[I+t]=o.b}if(n&c){var P=R+F;u?wdec14(e[R+t],e[P+t]):wdec16(e[R+t],e[P+t]),p=o.a,e[P+t]=o.b,e[R+t]=p}}if(i&c)for(var R=M,A=M+a*(n-f);R<=A;R+=C){var U=R+S;u?wdec14(e[R+t],e[U+t]):wdec16(e[R+t],e[U+t]),p=o.a,e[U+t]=o.b,e[R+t]=p}f=c,c>>=1}}(a,m.start+y,m.nx,m.size,m.ny,m.nx*m.size,p);!function(e,t,n){for(var a=0;a<n;++a)t[a]=e[t[a]]}(f,a,s);for(var M=0,x=new Uint8Array(a.buffer.byteLength),F=0;F<e.lines;F++)for(var _=0;_<e.channels;_++){var m=l[_],S=m.nx*m.size,C=new Uint8Array(a.buffer,2*m.end,2*S);x.set(C,M),M+=2*S,m.end+=S}return new DataView(x.buffer)}function uncompressPXR(e){var t=unzlibSync(e.array.slice(e.offset.value,e.offset.value+e.size));let n=e.lines*e.channels*e.width,a=1==e.type?new Uint16Array(n):new Uint32Array(n),i=0,o=0,s=[,,,,];for(let n=0;n<e.lines;n++)for(let n=0;n<e.channels;n++){let n=0;switch(e.type){case 1:s[0]=i,s[1]=s[0]+e.width,i=s[1]+e.width;for(let i=0;i<e.width;++i){let e=t[s[0]++]<<8|t[s[1]++];n+=e,a[o]=n,o++}break;case 2:s[0]=i,s[1]=s[0]+e.width,s[2]=s[1]+e.width,i=s[2]+e.width;for(let i=0;i<e.width;++i){let e=t[s[0]++]<<24|t[s[1]++]<<16|t[s[2]++]<<8;n+=e,a[o]=n,o++}}}return new DataView(a.buffer)}function uncompressDWA(e){var t=e.viewer,n={value:e.offset.value},a=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:parseInt64(t,n),unknownUncompressedSize:parseInt64(t,n),unknownCompressedSize:parseInt64(t,n),acCompressedSize:parseInt64(t,n),dcCompressedSize:parseInt64(t,n),rleCompressedSize:parseInt64(t,n),rleUncompressedSize:parseInt64(t,n),rleRawSize:parseInt64(t,n),totalAcUncompressedCount:parseInt64(t,n),totalDcUncompressedCount:parseInt64(t,n),acCompression:parseInt64(t,n)};if(i.version<2)throw"EXRLoader.parse: "+c.compression+" version "+i.version+" is unsupported";for(var o=[],s=parseUint16(t,n)-2;s>0;){var u=parseNullTerminatedString(t.buffer,n),d=parseUint8(t,n),f=d>>2&3,p=(d>>4)-1,h=new Int8Array([p])[0],m=parseUint8(t,n);o.push({name:u,index:h,type:m,compression:f}),s-=u.length+3}for(var y=c.channels,M=Array(e.channels),x=0;x<e.channels;++x){var F=M[x]={},_=y[x];F.name=_.name,F.compression=0,F.decoded=!1,F.type=_.pixelType,F.pLinear=_.pLinear,F.width=e.width,F.height=e.lines}for(var S={idx:[,,,]},C=0;C<e.channels;++C)for(var F=M[C],x=0;x<o.length;++x){var R=o[x];F.name==R.name&&(F.compression=R.compression,R.index>=0&&(S.idx[R.index]=C),F.offset=C)}if(i.acCompressedSize>0)switch(i.acCompression){case 0:var A=new Uint16Array(i.totalAcUncompressedCount);hufUncompress(e.array,t,n,i.acCompressedSize,A,i.totalAcUncompressedCount);break;case 1:var U=e.array.slice(n.value,n.value+i.totalAcUncompressedCount),P=unzlibSync(U),A=new Uint16Array(P.buffer);n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){var I={array:e.array,offset:n,size:i.dcCompressedSize},T=new Uint16Array(uncompressZIP(I).buffer);n.value+=i.dcCompressedSize}if(i.rleRawSize>0){var U=e.array.slice(n.value,n.value+i.rleCompressedSize),P=unzlibSync(U),k=decodeRunLength(P.buffer);n.value+=i.rleCompressedSize}for(var L=0,O=Array(M.length),x=0;x<O.length;++x)O[x]=[];for(var z=0;z<e.lines;++z)for(var B=0;B<M.length;++B)O[B].push(L),L+=M[B].width*e.type*2;!function(e,t,n,a,i,o){var s=new DataView(o.buffer),u=n[e.idx[0]].width,d=n[e.idx[0]].height,c=Math.floor(u/8),f=Math.ceil(u/8),p=Math.ceil(d/8),h=u-(f-1)*8,m=d-(p-1)*8,y={value:0},M=[,,,],x=[,,,],F=[,,,],_=[,,,],S=[,,,];for(let n=0;n<3;++n)S[n]=t[e.idx[n]],M[n]=n<1?0:M[n-1]+f*p,x[n]=new Float32Array(64),F[n]=new Uint16Array(64),_[n]=new Uint16Array(64*f);for(let t=0;t<p;++t){var C,R,A=8;t==p-1&&(A=m);var U=8;for(let e=0;e<f;++e){e==f-1&&(U=h);for(let e=0;e<3;++e)F[e].fill(0),F[e][0]=i[M[e]++],function(e,t,n){for(var a,i=1;i<64;)65280==(a=t[e.value])?i=64:a>>8==255?i+=255&a:(n[i]=a,i++),e.value++}(y,a,F[e]),C=F[e],(R=x[e])[0]=decodeFloat16(C[0]),R[1]=decodeFloat16(C[1]),R[2]=decodeFloat16(C[5]),R[3]=decodeFloat16(C[6]),R[4]=decodeFloat16(C[14]),R[5]=decodeFloat16(C[15]),R[6]=decodeFloat16(C[27]),R[7]=decodeFloat16(C[28]),R[8]=decodeFloat16(C[2]),R[9]=decodeFloat16(C[4]),R[10]=decodeFloat16(C[7]),R[11]=decodeFloat16(C[13]),R[12]=decodeFloat16(C[16]),R[13]=decodeFloat16(C[26]),R[14]=decodeFloat16(C[29]),R[15]=decodeFloat16(C[42]),R[16]=decodeFloat16(C[3]),R[17]=decodeFloat16(C[8]),R[18]=decodeFloat16(C[12]),R[19]=decodeFloat16(C[17]),R[20]=decodeFloat16(C[25]),R[21]=decodeFloat16(C[30]),R[22]=decodeFloat16(C[41]),R[23]=decodeFloat16(C[43]),R[24]=decodeFloat16(C[9]),R[25]=decodeFloat16(C[11]),R[26]=decodeFloat16(C[18]),R[27]=decodeFloat16(C[24]),R[28]=decodeFloat16(C[31]),R[29]=decodeFloat16(C[40]),R[30]=decodeFloat16(C[44]),R[31]=decodeFloat16(C[53]),R[32]=decodeFloat16(C[10]),R[33]=decodeFloat16(C[19]),R[34]=decodeFloat16(C[23]),R[35]=decodeFloat16(C[32]),R[36]=decodeFloat16(C[39]),R[37]=decodeFloat16(C[45]),R[38]=decodeFloat16(C[52]),R[39]=decodeFloat16(C[54]),R[40]=decodeFloat16(C[20]),R[41]=decodeFloat16(C[22]),R[42]=decodeFloat16(C[33]),R[43]=decodeFloat16(C[38]),R[44]=decodeFloat16(C[46]),R[45]=decodeFloat16(C[51]),R[46]=decodeFloat16(C[55]),R[47]=decodeFloat16(C[60]),R[48]=decodeFloat16(C[21]),R[49]=decodeFloat16(C[34]),R[50]=decodeFloat16(C[37]),R[51]=decodeFloat16(C[47]),R[52]=decodeFloat16(C[50]),R[53]=decodeFloat16(C[56]),R[54]=decodeFloat16(C[59]),R[55]=decodeFloat16(C[61]),R[56]=decodeFloat16(C[35]),R[57]=decodeFloat16(C[36]),R[58]=decodeFloat16(C[48]),R[59]=decodeFloat16(C[49]),R[60]=decodeFloat16(C[57]),R[61]=decodeFloat16(C[58]),R[62]=decodeFloat16(C[62]),R[63]=decodeFloat16(C[63]),function(e){let t=.5*Math.cos(3.14159/16),n=.5*Math.cos(3.14159/8),a=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(3*3.14159/8);for(var o=[,,,,],s=[,,,,],l=[,,,,],u=[,,,,],d=0;d<8;++d){var c=8*d;o[0]=n*e[c+2],o[1]=i*e[c+2],o[2]=n*e[c+6],o[3]=i*e[c+6],s[0]=t*e[c+1]+a*e[c+3]+.2777854612564676*e[c+5]+.09754573032714427*e[c+7],s[1]=a*e[c+1]-.09754573032714427*e[c+3]-t*e[c+5]-.2777854612564676*e[c+7],s[2]=.2777854612564676*e[c+1]-t*e[c+3]+.09754573032714427*e[c+5]+a*e[c+7],s[3]=.09754573032714427*e[c+1]-.2777854612564676*e[c+3]+a*e[c+5]-t*e[c+7],l[0]=.35355362513961314*(e[c+0]+e[c+4]),l[3]=.35355362513961314*(e[c+0]-e[c+4]),l[1]=o[0]+o[3],l[2]=o[1]-o[2],u[0]=l[0]+l[1],u[1]=l[3]+l[2],u[2]=l[3]-l[2],u[3]=l[0]-l[1],e[c+0]=u[0]+s[0],e[c+1]=u[1]+s[1],e[c+2]=u[2]+s[2],e[c+3]=u[3]+s[3],e[c+4]=u[3]-s[3],e[c+5]=u[2]-s[2],e[c+6]=u[1]-s[1],e[c+7]=u[0]-s[0]}for(var f=0;f<8;++f)o[0]=n*e[16+f],o[1]=i*e[16+f],o[2]=n*e[48+f],o[3]=i*e[48+f],s[0]=t*e[8+f]+a*e[24+f]+.2777854612564676*e[40+f]+.09754573032714427*e[56+f],s[1]=a*e[8+f]-.09754573032714427*e[24+f]-t*e[40+f]-.2777854612564676*e[56+f],s[2]=.2777854612564676*e[8+f]-t*e[24+f]+.09754573032714427*e[40+f]+a*e[56+f],s[3]=.09754573032714427*e[8+f]-.2777854612564676*e[24+f]+a*e[40+f]-t*e[56+f],l[0]=.35355362513961314*(e[f]+e[32+f]),l[3]=.35355362513961314*(e[f]-e[32+f]),l[1]=o[0]+o[3],l[2]=o[1]-o[2],u[0]=l[0]+l[1],u[1]=l[3]+l[2],u[2]=l[3]-l[2],u[3]=l[0]-l[1],e[0+f]=u[0]+s[0],e[8+f]=u[1]+s[1],e[16+f]=u[2]+s[2],e[24+f]=u[3]+s[3],e[32+f]=u[3]-s[3],e[40+f]=u[2]-s[2],e[48+f]=u[1]-s[1],e[56+f]=u[0]-s[0]}(x[e]);!function(e){for(var t=0;t<64;++t){var n=e[0][t],a=e[1][t],i=e[2][t];e[0][t]=n+1.5747*i,e[1][t]=n-.1873*a-.4682*i,e[2][t]=n+1.8556*a}}(x);for(let t=0;t<3;++t)!function(e,t,n){for(var a,i=0;i<64;++i)t[n+i]=l.A5E.toHalfFloat((a=e[i])<=1?Math.sign(a)*Math.pow(Math.abs(a),2.2):Math.sign(a)*Math.pow(9.025013291561939,Math.abs(a)-1))}(x[t],_[t],64*e)}let o=0;for(let a=0;a<3;++a){let i=n[e.idx[a]].type;for(let e=8*t;e<8*t+A;++e){o=S[a][e];for(let t=0;t<c;++t){let n=64*t+(7&e)*8;s.setUint16(o+0*i,_[a][n+0],!0),s.setUint16(o+2*i,_[a][n+1],!0),s.setUint16(o+4*i,_[a][n+2],!0),s.setUint16(o+6*i,_[a][n+3],!0),s.setUint16(o+8*i,_[a][n+4],!0),s.setUint16(o+10*i,_[a][n+5],!0),s.setUint16(o+12*i,_[a][n+6],!0),s.setUint16(o+14*i,_[a][n+7],!0),o+=16*i}}if(c!=f)for(let e=8*t;e<8*t+A;++e){let t=S[a][e]+8*c*2*i,n=64*c+(7&e)*8;for(let e=0;e<U;++e)s.setUint16(t+2*e*i,_[a][n+e],!0)}}}for(var P=new Uint16Array(u),s=new DataView(o.buffer),I=0;I<3;++I){n[e.idx[I]].decoded=!0;var T=n[e.idx[I]].type;if(2==n[I].type)for(var k=0;k<d;++k){let e=S[I][k];for(var L=0;L<u;++L)P[L]=s.getUint16(e+2*L*T,!0);for(var L=0;L<u;++L)s.setFloat32(e+2*L*T,decodeFloat16(P[L]),!0)}}}(S,O,M,A,T,a);for(var x=0;x<M.length;++x){var F=M[x];if(!F.decoded){if(2===F.compression)for(var H=0,N=0,z=0;z<e.lines;++z){for(var j=O[x][H],W=0;W<F.width;++W){for(var G=0;G<2*F.type;++G)a[j++]=k[N+G*F.width*F.height];N++}H++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(a.buffer)}function parseNullTerminatedString(e,t){for(var n=new Uint8Array(e),a=0;0!=n[t.value+a];)a+=1;var i=new TextDecoder().decode(n.slice(t.value,t.value+a));return t.value=t.value+a+1,i}function parseInt32(e,t){var n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function parseUint32(e,t){var n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function parseUint8Array(e,t){var n=e[t.value];return t.value=t.value+1,n}function parseUint8(e,t){var n=e.getUint8(t.value);return t.value=t.value+1,n}let parseInt64=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function parseFloat32(e,t){var n=e.getFloat32(t.value,!0);return t.value+=4,n}function decodeFloat32(e,t){return l.A5E.toHalfFloat(parseFloat32(e,t))}function decodeFloat16(e){var t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):6103515625e-14*(n/1024))}function parseUint16(e,t){var n=e.getUint16(t.value,!0);return t.value+=2,n}function parseFloat16(e,t){return decodeFloat16(parseUint16(e,t))}let s=new DataView(e),u=new Uint8Array(e),d={value:0},c=function(e,t,n){let a={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";a.version=e.getUint8(4);let i=e.getUint8(5);a.spec={singleTile:!!(2&i),longName:!!(4&i),deepFormat:!!(8&i),multiPart:!!(16&i)},n.value=8;for(var o=!0;o;){var s=parseNullTerminatedString(t,n);if(0==s)o=!1;else{var l=parseNullTerminatedString(t,n),u=parseUint32(e,n),d=function(e,t,n,a,i){var o,s,l,u,d;if("string"===a||"stringvector"===a||"iccProfile"===a)return o=new TextDecoder().decode(new Uint8Array(t).slice(n.value,n.value+i)),n.value=n.value+i,o;if("chlist"===a)return function(e,t,n,a){for(var i=n.value,o=[];n.value<i+a-1;){var s=parseNullTerminatedString(t,n),l=parseInt32(e,n),u=parseUint8(e,n);n.value+=3;var d=parseInt32(e,n),c=parseInt32(e,n);o.push({name:s,pixelType:l,pLinear:u,xSampling:d,ySampling:c})}return n.value+=1,o}(e,t,n,i);if("chromaticities"===a)return s=parseFloat32(e,n),l=parseFloat32(e,n),u=parseFloat32(e,n),d=parseFloat32(e,n),{redX:s,redY:l,greenX:u,greenY:d,blueX:parseFloat32(e,n),blueY:parseFloat32(e,n),whiteX:parseFloat32(e,n),whiteY:parseFloat32(e,n)};if("compression"===a)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][parseUint8(e,n)];if("box2i"===a)return{xMin:parseUint32(e,n),yMin:parseUint32(e,n),xMax:parseUint32(e,n),yMax:parseUint32(e,n)};if("lineOrder"===a)return["INCREASING_Y"][parseUint8(e,n)];if("float"===a)return parseFloat32(e,n);else if("v2f"===a)return[parseFloat32(e,n),parseFloat32(e,n)];else if("v3f"===a)return[parseFloat32(e,n),parseFloat32(e,n),parseFloat32(e,n)];else if("int"===a)return parseInt32(e,n);else if("rational"===a)return[parseInt32(e,n),parseUint32(e,n)];else if("timecode"===a)return[parseUint32(e,n),parseUint32(e,n)];else return"preview"===a?(n.value+=i,"skipped"):void(n.value+=i)}(e,t,n,l,u);void 0===d?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):a[s]=d}}if((-5&i)!=0)throw console.error("EXRHeader:",a),"THREE.EXRLoader: provided file is currently unsupported.";return a}(s,e,d),f=function(e,t,n,a,i){let o={size:0,viewer:t,array:n,offset:a,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[B?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=uncompressRAW;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=uncompressRLE;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=uncompressZIP;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=uncompressZIP;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=uncompressPIZ;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=uncompressPXR;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=uncompressDWA;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=uncompressDWA;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(o.scanlineBlockSize=o.lines,1==o.type)switch(i){case l.VzW:o.getter=parseFloat16,o.inputSize=2;break;case l.cLu:o.getter=parseUint16,o.inputSize=2}else if(2==o.type)switch(i){case l.VzW:o.getter=parseFloat32,o.inputSize=4;break;case l.cLu:o.getter=decodeFloat32,o.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".";o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(var s=0;s<o.blockCount;s++)parseInt64(t,a);o.outputChannels=3==o.channels?4:o.channels;let u=o.width*o.height*o.outputChannels;switch(i){case l.VzW:o.byteArray=new Float32Array(u),o.channels<o.outputChannels&&o.byteArray.fill(1,0,u);break;case l.cLu:o.byteArray=new Uint16Array(u),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,u);break;default:console.error("THREE.EXRLoader: unsupported type: ",i)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?o.format=l.wk1:o.format=l.hEm,B?o.colorSpace="srgb-linear":o.encoding=3e3,o}(c,s,u,d,this.type),p={value:0},h={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<f.height/f.scanlineBlockSize;e++){let t=parseUint32(s,d);f.size=parseUint32(s,d),f.lines=t+f.scanlineBlockSize>f.height?f.height-t:f.scanlineBlockSize;let n=f.size<f.lines*f.bytesPerLine,a=n?f.uncompress(f):uncompressRAW(f);d.value+=f.size;for(let t=0;t<f.scanlineBlockSize;t++){let n=t+e*f.scanlineBlockSize;if(n>=f.height)break;for(let e=0;e<f.channels;e++){let i=h[c.channels[e].name];for(let o=0;o<f.width;o++){p.value=(t*(f.channels*f.width)+e*f.width+o)*f.inputSize;let s=(f.height-1-n)*(f.width*f.outputChannels)+o*f.outputChannels+i;f.byteArray[s]=f.getter(a,p)}}}}return{header:c,width:f.width,height:f.height,data:f.byteArray,format:f.format,[B?"colorSpace":"encoding"]:f[B?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,a){return super.load(e,function(e,n){B?e.colorSpace=n.colorSpace:e.encoding=n.encoding,e.minFilter=l.wem,e.magFilter=l.wem,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,n)},n,a)}};var H=n(6375);let getBufferForType=(e,t,n)=>{let a;switch(e){case l.ywz:a=new Uint8ClampedArray(t*n*4);break;case l.cLu:a=new Uint16Array(t*n*4);break;case l.JQ4:a=new Uint32Array(t*n*4);break;case l.T95:a=new Int8Array(t*n*4);break;case l.iAb:a=new Int16Array(t*n*4);break;case l.Kz5:a=new Int32Array(t*n*4);break;case l.VzW:a=new Float32Array(t*n*4);break;default:throw Error("Unsupported data type")}return a},canReadPixels=(e,t,n,i)=>{if(void 0!==a)return a;let o=new l.dd2(1,1,i);t.setRenderTarget(o);let s=new l.Kj0(new l._12,new l.vBJ({color:16777215}));t.render(s,n),t.setRenderTarget(null);let u=getBufferForType(e,o.width,o.height);return t.readRenderTargetPixels(o,0,0,o.width,o.height,u),o.dispose(),s.geometry.dispose(),s.material.dispose(),a=0!==u[0]};let QuadRenderer_DuOPRGA4_QuadRenderer=class QuadRenderer_DuOPRGA4_QuadRenderer{constructor(e){var t,n,a,i,o,s,u,d,c,f,p,h,m,y,M,x;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)},this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;let F={format:l.wk1,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null===(t=e.renderTargetOptions)||void 0===t?void 0:t.anisotropy)!==void 0?null===(n=e.renderTargetOptions)||void 0===n?void 0:n.anisotropy:1,generateMipmaps:(null===(a=e.renderTargetOptions)||void 0===a?void 0:a.generateMipmaps)!==void 0&&(null===(i=e.renderTargetOptions)||void 0===i?void 0:i.generateMipmaps),magFilter:(null===(o=e.renderTargetOptions)||void 0===o?void 0:o.magFilter)!==void 0?null===(s=e.renderTargetOptions)||void 0===s?void 0:s.magFilter:l.wem,minFilter:(null===(u=e.renderTargetOptions)||void 0===u?void 0:u.minFilter)!==void 0?null===(d=e.renderTargetOptions)||void 0===d?void 0:d.minFilter:l.wem,samples:(null===(c=e.renderTargetOptions)||void 0===c?void 0:c.samples)!==void 0?null===(f=e.renderTargetOptions)||void 0===f?void 0:f.samples:void 0,wrapS:(null===(p=e.renderTargetOptions)||void 0===p?void 0:p.wrapS)!==void 0?null===(h=e.renderTargetOptions)||void 0===h?void 0:h.wrapS:l.uWy,wrapT:(null===(m=e.renderTargetOptions)||void 0===m?void 0:m.wrapT)!==void 0?null===(y=e.renderTargetOptions)||void 0===y?void 0:y.wrapT:l.uWy};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=QuadRenderer_DuOPRGA4_QuadRenderer.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new l.xsS,this._camera=new l.iKG,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!canReadPixels(this._type,this._renderer,this._camera,F)){let e;this._type===l.cLu&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?l.VzW:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${l.VzW}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new l.Kj0(new l._12,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new l.dd2(this.width,this.height,F),this._renderTarget.texture.mapping=(null===(M=e.renderTargetOptions)||void 0===M?void 0:M.mapping)!==void 0?null===(x=e.renderTargetOptions)||void 0===x?void 0:x.mapping:l.xfE}static instantiateRenderer(){let e=new H.WebGLRenderer;return e.setSize(128,128),e}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=getBufferForType(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new l.IEO(this.toArray(),this.width,this.height,l.wk1,this._type,(null==e?void 0:e.mapping)||l.xfE,(null==e?void 0:e.wrapS)||l.uWy,(null==e?void 0:e.wrapT)||l.uWy,(null==e?void 0:e.magFilter)||l.wem,(null==e?void 0:e.minFilter)||l.wem,(null==e?void 0:e.anisotropy)||1,l.GUF);return t.generateMipmaps=(null==e?void 0:e.generateMipmaps)!==void 0&&(null==e?void 0:e.generateMipmaps),t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof l.jyz&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof l.xEZ&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof l.xEZ&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}};let N=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,j=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;let GainMapDecoderMaterial=class GainMapDecoderMaterial extends l.jyz{constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:a,gainMapMax:i,maxDisplayBoost:o,hdrCapacityMin:s,hdrCapacityMax:u,sdr:d,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:N,fragmentShader:j,uniforms:{sdr:{value:d},gainMap:{value:c},gamma:{value:new l.Pa4(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new l.Pa4().fromArray(t)},offsetSdr:{value:new l.Pa4().fromArray(n)},gainMapMin:{value:new l.Pa4().fromArray(a)},gainMapMax:{value:new l.Pa4().fromArray(i)},weightFactor:{value:(Math.log2(o)-s)/(u-s)}},blending:l.jFi,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=s,this._hdrCapacityMax=u,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}};let GainMapNotFoundError=class GainMapNotFoundError extends Error{};let XMPMetadataNotFoundError=class XMPMetadataNotFoundError extends Error{};let getXMLValue=(e,t,n)=>{let a=RegExp(`${t}="([^"]*)"`,"i").exec(e);if(a)return a[1];let i=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(i){let e=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(void 0!==n)return n;throw Error(`Can't find ${t} in gainmap metadata`)},extractXMP=e=>{let t;let n=(t="undefined"!=typeof TextDecoder?new TextDecoder().decode(e):e.toString()).indexOf("<x:xmpmeta");for(;-1!==n;){let e=t.indexOf("x:xmpmeta>",n),a=t.slice(n,e+10);try{let e=getXMLValue(a,"hdrgm:GainMapMin","0"),t=getXMLValue(a,"hdrgm:GainMapMax"),n=getXMLValue(a,"hdrgm:Gamma","1"),i=getXMLValue(a,"hdrgm:OffsetSDR","0.015625"),o=getXMLValue(a,"hdrgm:OffsetHDR","0.015625"),s=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(a),l=s?s[1]:"0",u=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(a);if(!u)throw Error("Incomplete gainmap metadata");let d=u[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetSdr:Array.isArray(i)?i.map(e=>parseFloat(e)):[parseFloat(i),parseFloat(i),parseFloat(i)],offsetHdr:Array.isArray(o)?o.map(e=>parseFloat(e)):[parseFloat(o),parseFloat(o),parseFloat(o)],hdrCapacityMin:parseFloat(l),hdrCapacityMax:parseFloat(d)}}catch(e){}n=t.indexOf("<x:xmpmeta",e)}};let MPFExtractor=class MPFExtractor{constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,n)=>{let a;let i=this.options.debug,o=new DataView(e.buffer);if(65496!==o.getUint16(0)){n(Error("Not a valid jpeg"));return}let s=o.byteLength,l=2,u=0;for(;l<s;){if(++u>250){n(Error(`Found no marker after ${u} loops 😵`));return}if(255!==o.getUint8(l)){n(Error(`Not a valid marker at offset 0x${l.toString(16)}, found: 0x${o.getUint8(l).toString(16)}`));return}if(a=o.getUint8(l+1),i&&console.log(`Marker: ${a.toString(16)}`),226===a){i&&console.log("Found APP2 marker (0xffe2)");let e=l+4;if(1297106432===o.getUint32(e)){let a;let i=e+4;if(18761===o.getUint16(i))a=!1;else if(19789===o.getUint16(i))a=!0;else{n(Error("No valid endianness marker found in TIFF header"));return}if(42!==o.getUint16(i+2,!a)){n(Error("Not valid TIFF data! (no 0x002A marker)"));return}let s=o.getUint32(i+4,!a);if(s<8){n(Error("Not valid TIFF data! (First offset less than 8)"));return}let l=i+s,u=o.getUint16(l,!a),d=l+2,c=0;for(let e=d;e<d+12*u;e+=12)45057===o.getUint16(e,!a)&&(c=o.getUint32(e+8,!a));let f=l+2+12*u+4,p=[];for(let e=f;e<f+16*c;e+=16){let t={MPType:o.getUint32(e,!a),size:o.getUint32(e+4,!a),dataOffset:o.getUint32(e+8,!a),dependantImages:o.getUint32(e+12,!a),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=i+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,p.push(t)}if(this.options.extractNonFII&&p.length){let e=new Blob([o]),n=[];for(let t of p){if(t.isFII&&!this.options.extractFII)continue;let a=e.slice(t.start,t.end+1,"image/jpeg");n.push(a)}t(n)}}}l+=2+o.getUint16(l+2)}})}};let extractGainmapFromJPEG=async e=>{let t=extractXMP(e);if(!t)throw new XMPMetadataNotFoundError("Gain map XMP metadata not found");let n=new MPFExtractor({extractFII:!0,extractNonFII:!0}),a=await n.extract(e);if(2!==a.length)throw new GainMapNotFoundError("Gain map recovery image not found");return{sdr:new Uint8Array(await a[0].arrayBuffer()),gainMap:new Uint8Array(await a[1].arrayBuffer()),metadata:t}},getHTMLImageFromBlob=e=>new Promise((t,n)=>{let a=document.createElement("img");a.onload=()=>{t(a)},a.onerror=e=>{n(e)},a.src=URL.createObjectURL(e)});let LoaderBase=class LoaderBase extends l.aNw{constructor(e,t){super(t),e&&(this._renderer=e),this._internalLoadingManager=new l.lLk}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let e=new GainMapDecoderMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new l.xEZ,sdr:new l.xEZ});return new QuadRenderer_DuOPRGA4_QuadRenderer({width:16,height:16,type:l.cLu,colorSpace:l.GUF,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(e,t,n,a){let i,o;let s=a?new Blob([a],{type:"image/jpeg"}):void 0,u=new Blob([n],{type:"image/jpeg"}),d=!1;if("undefined"==typeof createImageBitmap){let e=await Promise.all([s?getHTMLImageFromBlob(s):Promise.resolve(void 0),getHTMLImageFromBlob(u)]);o=e[0],i=e[1],d=!0}else{let e=await Promise.all([s?createImageBitmap(s,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(u,{imageOrientation:"flipY"})]);o=e[0],i=e[1]}let c=new l.xEZ(o||new ImageData(2,2),l.xfE,l.uWy,l.uWy,l.wem,l.FDw,l.wk1,l.ywz,1,l.GUF);c.flipY=d,c.needsUpdate=!0;let f=new l.xEZ(i,l.xfE,l.uWy,l.uWy,l.wem,l.FDw,l.wk1,l.ywz,1,l.KI_);f.flipY=d,f.needsUpdate=!0,e.width=i.width,e.height=i.height,e.material.gainMap=c,e.material.sdr=f,e.material.gainMapMin=t.gainMapMin,e.material.gainMapMax=t.gainMapMax,e.material.offsetHdr=t.offsetHdr,e.material.offsetSdr=t.offsetSdr,e.material.gamma=t.gamma,e.material.hdrCapacityMin=t.hdrCapacityMin,e.material.hdrCapacityMax=t.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,t.hdrCapacityMax),e.material.needsUpdate=!0,e.render()}};let GainMapLoader=class GainMapLoader extends LoaderBase{load([e,t,n],a,i,o){let s,u,d;let c=this.prepareQuadRenderer(),loadCheck=async()=>{if(s&&u&&d){try{await this.render(c,d,s,u)}catch(a){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),"function"==typeof o&&o(a),c.disposeOnDemandRenderer();return}"function"==typeof a&&a(c),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),c.disposeOnDemandRenderer()}},f=!0,p=0,h=0,m=!0,y=0,M=0,x=!0,F=0,_=0,progressHandler=()=>{if("function"==typeof i){let e=p+y+F,t=h+M+_,n=f&&m&&x;i(new ProgressEvent("progress",{lengthComputable:n,loaded:t,total:e}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);let S=new l.hH6(this._internalLoadingManager);S.setResponseType("arraybuffer"),S.setRequestHeader(this.requestHeader),S.setPath(this.path),S.setWithCredentials(this.withCredentials),S.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");s=e,await loadCheck()},e=>{f=e.lengthComputable,h=e.loaded,p=e.total,progressHandler()},t=>{this.manager.itemError(e),"function"==typeof o&&o(t)});let C=new l.hH6(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");u=e,await loadCheck()},e=>{m=e.lengthComputable,M=e.loaded,y=e.total,progressHandler()},e=>{this.manager.itemError(t),"function"==typeof o&&o(e)});let R=new l.hH6(this._internalLoadingManager);return R.setRequestHeader(this.requestHeader),R.setPath(this.path),R.setWithCredentials(this.withCredentials),R.load(n,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");d=JSON.parse(e),await loadCheck()},e=>{x=e.lengthComputable,_=e.loaded,F=e.total,progressHandler()},e=>{this.manager.itemError(n),"function"==typeof o&&o(e)}),c}};let HDRJPGLoader=class HDRJPGLoader extends LoaderBase{load(e,t,n,a){let i=this.prepareQuadRenderer(),o=new l.hH6(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async n=>{let o,s,l;if("string"==typeof n)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let u=new Uint8Array(n);try{let e=await extractGainmapFromJPEG(u);o=e.sdr,s=e.gainMap,l=e.metadata}catch(t){if(t instanceof XMPMetadataNotFoundError||t instanceof GainMapNotFoundError)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),l={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},o=u;else throw t}try{await this.render(i,l,o,s)}catch(t){this.manager.itemError(e),"function"==typeof a&&a(t),i.disposeOnDemandRenderer();return}"function"==typeof t&&t(i),this.manager.itemEnd(e),i.disposeOnDemandRenderer()},n,t=>{this.manager.itemError(e),"function"==typeof a&&a(t)}),i}};let W={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},G="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",isArray=e=>Array.isArray(e),V=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function useEnvironment({files:e=V,path:t="",preset:n,encoding:a,extensions:i}={}){let u=null,d=!1;n&&(validatePreset(n),e=W[n],t=G),d=isArray(e);let{extension:c,isCubemap:f}=getExtension(e);if(!(u=getLoader(c)))throw Error("useEnvironment: Unrecognized file extension: "+e);let p=(0,s.D)(e=>e.gl);(0,o.useLayoutEffect)(()=>{("webp"===c||"jpg"===c||"jpeg"===c)&&p.domElement.addEventListener("webglcontextlost",function(){s.H.clear(u,d?[e]:e)},{once:!0})},[e,p.domElement]);let h=(0,s.H)(u,d?[e]:e,e=>{("webp"===c||"jpg"===c||"jpeg"===c)&&e.setRenderer(p),null==e.setPath||e.setPath(t),i&&i(e)}),m=d?h[0]:h;if("jpg"===c||"jpeg"===c||"webp"===c){var y;m=null==(y=m.renderTarget)?void 0:y.texture}return m.mapping=f?l.fY$:l.dSO,"colorSpace"in m?m.colorSpace=(null!=a?a:f)?"srgb":"srgb-linear":m.encoding=(null!=a?a:f)?3001:3e3,m}let X={files:V,path:"",preset:void 0,extensions:void 0};useEnvironment.preload=e=>{let t={...X,...e},{files:n,path:a=""}=t,{preset:i,extensions:o}=t;i&&(validatePreset(i),n=W[i],a=G);let{extension:l}=getExtension(n);if("webp"===l||"jpg"===l||"jpeg"===l)throw Error("useEnvironment: Preloading gainmaps is not supported");let u=getLoader(l);if(!u)throw Error("useEnvironment: Unrecognized file extension: "+n);s.H.preload(u,isArray(n)?[n]:n,e=>{null==e.setPath||e.setPath(a),o&&o(e)})};let Z={files:V,preset:void 0};function validatePreset(e){if(!(e in W))throw Error("Preset must be one of: "+Object.keys(W).join(", "))}function getExtension(e){var t;let n=isArray(e)&&6===e.length,a=isArray(e)&&3===e.length&&e.some(e=>e.endsWith("json")),i=isArray(e)?e[0]:e,o=n?"cube":a?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":null==(t=i.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase();return{extension:o,isCubemap:n,isGainmap:a}}function getLoader(e){let t="cube"===e?l.cBK:"hdr"===e?RGBELoader:"exr"===e?EXRLoader:"jpg"===e||"jpeg"===e?HDRJPGLoader:"webp"===e?GainMapLoader:null;return t}useEnvironment.clear=e=>{let t={...Z,...e},{files:n}=t,{preset:a}=t;a&&(validatePreset(a),n=W[a]);let{extension:i}=getExtension(n),o=getLoader(i);if(!o)throw Error("useEnvironment: Unrecognized file extension: "+n);s.H.clear(o,isArray(n)?[n]:n)};let isRef=e=>e.current&&e.current.isScene,resolveScene=e=>isRef(e)?e.current:e;function setEnvProps(e,t,n,a,i={}){var o,l,u,d;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};let c=resolveScene(t||n),f=c.background,p=c.environment,h={backgroundBlurriness:c.backgroundBlurriness,backgroundIntensity:c.backgroundIntensity,backgroundRotation:null!==(o=null==(l=c.backgroundRotation)||null==l.clone?void 0:l.clone())&&void 0!==o?o:[0,0,0],environmentIntensity:c.environmentIntensity,environmentRotation:null!==(u=null==(d=c.environmentRotation)||null==d.clone?void 0:d.clone())&&void 0!==u?u:[0,0,0]};return"only"!==e&&(c.environment=a),e&&(c.background=a),(0,s.k)(c,i),()=>{"only"!==e&&(c.environment=p),e&&(c.background=f),(0,s.k)(c,h)}}function EnvironmentMap({scene:e,background:t=!1,map:n,...a}){let i=(0,s.D)(e=>e.scene);return o.useLayoutEffect(()=>{if(n)return setEnvProps(t,e,i,n,a)}),null}function EnvironmentCube({background:e=!1,scene:t,blur:n,backgroundBlurriness:a,backgroundIntensity:i,backgroundRotation:l,environmentIntensity:u,environmentRotation:d,...c}){let f=useEnvironment(c),p=(0,s.D)(e=>e.scene);return o.useLayoutEffect(()=>setEnvProps(e,t,p,f,{backgroundBlurriness:null!=n?n:a,backgroundIntensity:i,backgroundRotation:l,environmentIntensity:u,environmentRotation:d})),o.useEffect(()=>()=>{f.dispose()},[f]),null}function EnvironmentPortal({children:e,near:t=.1,far:n=1e3,resolution:a=256,frames:i=1,map:u,background:d=!1,blur:c,backgroundBlurriness:f,backgroundIntensity:p,backgroundRotation:h,environmentIntensity:m,environmentRotation:y,scene:M,files:x,path:F,preset:_,extensions:S}){let C=(0,s.D)(e=>e.gl),R=(0,s.D)(e=>e.scene),A=o.useRef(null),[U]=o.useState(()=>new l.xsS),P=o.useMemo(()=>{let e=new l.oAp(a);return e.texture.type=l.cLu,e},[a]);o.useEffect(()=>()=>{P.dispose()},[P]),o.useLayoutEffect(()=>{if(1===i){let e=C.autoClear;C.autoClear=!0,A.current.update(C,U),C.autoClear=e}return setEnvProps(d,M,R,P.texture,{backgroundBlurriness:null!=c?c:f,backgroundIntensity:p,backgroundRotation:h,environmentIntensity:m,environmentRotation:y})},[e,U,P.texture,M,R,d,i,C]);let I=1;return(0,s.F)(()=>{if(i===1/0||I<i){let e=C.autoClear;C.autoClear=!0,A.current.update(C,U),C.autoClear=e,I++}}),o.createElement(o.Fragment,null,(0,s.h)(o.createElement(o.Fragment,null,e,o.createElement("cubeCamera",{ref:A,args:[t,n,P]}),x||_?o.createElement(EnvironmentCube,{background:!0,files:x,preset:_,path:F,extensions:S}):u?o.createElement(EnvironmentMap,{background:!0,map:u,extensions:S}):null),U))}function EnvironmentGround(e){var t,n,a,l;let u=useEnvironment(e),d=e.map||u;o.useMemo(()=>(0,s.e)({GroundProjectedEnvImpl:GroundProjectedEnv}),[]),o.useEffect(()=>()=>{u.dispose()},[u]);let c=o.useMemo(()=>[d],[d]),f=null==(t=e.ground)?void 0:t.height,p=null==(n=e.ground)?void 0:n.radius,h=null!==(a=null==(l=e.ground)?void 0:l.scale)&&void 0!==a?a:1e3;return o.createElement(o.Fragment,null,o.createElement(EnvironmentMap,(0,i.Z)({},e,{map:d})),o.createElement("groundProjectedEnvImpl",{args:c,scale:h,height:f,radius:p}))}function Environment(e){return e.ground?o.createElement(EnvironmentGround,e):e.map?o.createElement(EnvironmentMap,e):e.children?o.createElement(EnvironmentPortal,e):o.createElement(EnvironmentCube,e)}},2866:function(e,t,n){"use strict";n.d(t,{c:function(){return l}});var a=n(3428),i=n(2265),o=n(5362),s=n(2461);let isFunction=e=>"function"==typeof e,l=i.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,makeDefault:l,children:u,...d},c)=>{let f=(0,o.D)(({set:e})=>e),p=(0,o.D)(({camera:e})=>e),h=(0,o.D)(({size:e})=>e),m=i.useRef(null);i.useImperativeHandle(c,()=>m.current,[]);let y=i.useRef(null),M=function(e,t,n){let a=(0,o.D)(e=>e.size),l=(0,o.D)(e=>e.viewport),u="number"==typeof e?e:a.width*l.dpr,d="number"==typeof t?t:a.height*l.dpr,c=("number"==typeof e?void 0:e)||{},{samples:f=0,depth:p,...h}=c,m=i.useMemo(()=>{let e=new s.dd2(u,d,{minFilter:s.wem,magFilter:s.wem,type:s.cLu,...h});return p&&(e.depthTexture=new s.$YQ(u,d,s.VzW)),e.samples=f,e},[]);return i.useLayoutEffect(()=>{m.setSize(u,d),f&&(m.samples=f)},[f,m,u,d]),i.useEffect(()=>()=>m.dispose(),[]),m}(t);i.useLayoutEffect(()=>{d.manual||(m.current.aspect=h.width/h.height)},[h,d]),i.useLayoutEffect(()=>{m.current.updateProjectionMatrix()});let x=0,F=null,_=isFunction(u);return(0,o.F)(t=>{_&&(n===1/0||x<n)&&(y.current.visible=!1,t.gl.setRenderTarget(M),F=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,m.current),t.scene.background=F,t.gl.setRenderTarget(null),y.current.visible=!0,x++)}),i.useLayoutEffect(()=>{if(l)return f(()=>({camera:m.current})),()=>f(()=>({camera:p}))},[m,l,f]),i.createElement(i.Fragment,null,i.createElement("perspectiveCamera",(0,a.Z)({ref:m},d),!_&&u),i.createElement("group",{ref:y},_&&u(M.texture)))})},6154:function(e,t,n){"use strict";n.r(t),n.d(t,{Canvas:function(){return _},ReactThreeFiber:function(){return o.t},_roots:function(){return o.z},act:function(){return o.x},addAfterEffect:function(){return o.p},addEffect:function(){return o.o},addTail:function(){return o.q},advance:function(){return o.n},applyProps:function(){return o.k},buildGraph:function(){return o.y},context:function(){return o.g},createEvents:function(){return o.f},createPointerEvents:function(){return o.c},createPortal:function(){return o.h},createRoot:function(){return o.b},dispose:function(){return o.l},events:function(){return o.c},extend:function(){return o.e},flushGlobalEffects:function(){return o.s},flushSync:function(){return o.v},getRootState:function(){return o.w},invalidate:function(){return o.m},reconciler:function(){return o.j},render:function(){return o.r},unmountComponentAtNode:function(){return o.d},useFrame:function(){return o.F},useGraph:function(){return o.G},useInstanceHandle:function(){return o.A},useLoader:function(){return o.H},useStore:function(){return o.C},useThree:function(){return o.D}});var a,i,o=n(5362),s=n(2265),l=n(6375);function g(e,t){let n;return(...a)=>{window.clearTimeout(n),n=window.setTimeout(()=>e(...a),t)}}let u=["x","y","top","bottom","left","right","width","height"],D=(e,t)=>u.every(n=>e[n]===t[n]);var d=Object.defineProperty,c=Object.defineProperties,f=Object.getOwnPropertyDescriptors,p=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,m=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,n)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,__spreadValues=(e,t)=>{for(var n in t||(t={}))h.call(t,n)&&__defNormalProp(e,n,t[n]);if(p)for(var n of p(t))m.call(t,n)&&__defNormalProp(e,n,t[n]);return e},__spreadProps=(e,t)=>c(e,f(t));function wrapContext(e){try{return Object.defineProperties(e,{_currentRenderer:{get:()=>null,set(){}},_currentRenderer2:{get:()=>null,set(){}}})}catch(t){return e}}"undefined"!=typeof window&&((null==(a=window.document)?void 0:a.createElement)||(null==(i=window.navigator)?void 0:i.product)==="ReactNative")?s.useLayoutEffect:s.useEffect;let y=console.error;console.error=function(){let e=[...arguments].join("");if((null==e?void 0:e.startsWith("Warning:"))&&e.includes("useContext")){console.error=y;return}return y.apply(this,arguments)};let M=wrapContext(s.createContext(null));let FiberProvider=class FiberProvider extends s.Component{render(){return s.createElement(M.Provider,{value:this._reactInternals},this.props.children)}};var x=n(7437);n(5505),n(1177),n(4362);let F=s.forwardRef(function({children:e,fallback:t,resize:n,style:a,gl:i,events:u=o.c,eventSource:d,eventPrefix:c,shadows:f,linear:p,flat:h,legacy:m,orthographic:y,frameloop:F,dpr:_,performance:S,raycaster:C,camera:R,scene:A,onPointerMissed:U,onCreated:P,...I},T){s.useMemo(()=>(0,o.e)(l),[]);let k=function(){let e=function(){let e=function(){let e=s.useContext(M);if(null===e)throw Error("its-fine: useFiber must be called within a <FiberProvider />!");let t=s.useId(),n=s.useMemo(()=>{for(let n of[e,null==e?void 0:e.alternate]){if(!n)continue;let e=function traverseFiber(e,t,n){if(!e)return;if(!0===n(e))return e;let a=t?e.return:e.child;for(;a;){let e=traverseFiber(a,t,n);if(e)return e;a=t?null:a.sibling}}(n,!1,e=>{let n=e.memoizedState;for(;n;){if(n.memoizedState===t)return!0;n=n.next}});if(e)return e}},[e,t]);return n}(),[t]=s.useState(()=>new Map);t.clear();let n=e;for(;n;){if(n.type&&"object"==typeof n.type){let e=void 0===n.type._context&&n.type.Provider===n.type,a=e?n.type:n.type._context;a&&a!==M&&!t.has(a)&&t.set(a,s.useContext(wrapContext(a)))}n=n.return}return t}();return s.useMemo(()=>Array.from(e.keys()).reduce((t,n)=>a=>s.createElement(t,null,s.createElement(n.Provider,__spreadProps(__spreadValues({},a),{value:e.get(n)}))),e=>s.createElement(FiberProvider,__spreadValues({},e))),[e])}(),[L,O]=function({debounce:e,scroll:t,polyfill:n,offsetSize:a}={debounce:0,scroll:!1,offsetSize:!1}){var i;let o=n||("undefined"==typeof window?class{}:window.ResizeObserver);if(!o)throw Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");let[l,u]=(0,s.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),d=(0,s.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l,orientationHandler:null}),c=e?"number"==typeof e?e:e.scroll:null,f=e?"number"==typeof e?e:e.resize:null,p=(0,s.useRef)(!1);(0,s.useEffect)(()=>(p.current=!0,()=>void(p.current=!1)));let[h,m,y]=(0,s.useMemo)(()=>{let r=()=>{if(!d.current.element)return;let{left:e,top:t,width:n,height:i,bottom:o,right:s,x:l,y:c}=d.current.element.getBoundingClientRect(),f={left:e,top:t,width:n,height:i,bottom:o,right:s,x:l,y:c};d.current.element instanceof HTMLElement&&a&&(f.height=d.current.element.offsetHeight,f.width=d.current.element.offsetWidth),Object.freeze(f),p.current&&!D(d.current.lastBounds,f)&&u(d.current.lastBounds=f)};return[r,f?g(r,f):r,c?g(r,c):r]},[u,a,c,f]);function v(){d.current.scrollContainers&&(d.current.scrollContainers.forEach(e=>e.removeEventListener("scroll",y,!0)),d.current.scrollContainers=null),d.current.resizeObserver&&(d.current.resizeObserver.disconnect(),d.current.resizeObserver=null),d.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",d.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",d.current.orientationHandler))}function b(){d.current.element&&(d.current.resizeObserver=new o(y),d.current.resizeObserver.observe(d.current.element),t&&d.current.scrollContainers&&d.current.scrollContainers.forEach(e=>e.addEventListener("scroll",y,{capture:!0,passive:!0})),d.current.orientationHandler=()=>{y()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",d.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",d.current.orientationHandler))}return i=!!t,(0,s.useEffect)(()=>{if(i)return window.addEventListener("scroll",y,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",y,!0)},[y,i]),(0,s.useEffect)(()=>(window.addEventListener("resize",m),()=>void window.removeEventListener("resize",m)),[m]),(0,s.useEffect)(()=>{v(),b()},[t,y,m]),(0,s.useEffect)(()=>v,[]),[e=>{e&&e!==d.current.element&&(v(),d.current.element=e,d.current.scrollContainers=function E(e){let t=[];if(!e||e===document.body)return t;let{overflow:n,overflowX:a,overflowY:i}=window.getComputedStyle(e);return[n,a,i].some(e=>"auto"===e||"scroll"===e)&&t.push(e),[...t,...E(e.parentElement)]}(e),b())},l,h]}({scroll:!0,debounce:{scroll:50,resize:0},...n}),z=s.useRef(null),B=s.useRef(null);s.useImperativeHandle(T,()=>z.current);let H=(0,o.u)(U),[N,j]=s.useState(!1),[W,G]=s.useState(!1);if(N)throw N;if(W)throw W;let V=s.useRef(null);(0,o.a)(()=>{let t=z.current;O.width>0&&O.height>0&&t&&(V.current||(V.current=(0,o.b)(t)),V.current.configure({gl:i,events:u,shadows:f,linear:p,flat:h,legacy:m,orthographic:y,frameloop:F,dpr:_,performance:S,raycaster:C,camera:R,scene:A,size:O,onPointerMissed:(...e)=>null==H.current?void 0:H.current(...e),onCreated:e=>{null==e.events.connect||e.events.connect(d?(0,o.i)(d)?d.current:d:B.current),c&&e.setEvents({compute:(e,t)=>{let n=e[c+"X"],a=e[c+"Y"];t.pointer.set(n/t.size.width*2-1,-(2*(a/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==P||P(e)}}),V.current.render((0,x.jsx)(k,{children:(0,x.jsx)(o.E,{set:G,children:(0,x.jsx)(s.Suspense,{fallback:(0,x.jsx)(o.B,{set:j}),children:e})})})))}),s.useEffect(()=>{let e=z.current;if(e)return()=>(0,o.d)(e)},[]);let X=d?"none":"auto";return(0,x.jsx)("div",{ref:B,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:X,...a},...I,children:(0,x.jsx)("div",{ref:L,style:{width:"100%",height:"100%"},children:(0,x.jsx)("canvas",{ref:z,style:{display:"block"},children:t})})})}),_=s.forwardRef(function(e,t){return(0,x.jsx)(FiberProvider,{children:(0,x.jsx)(F,{...e,ref:t})})})},4033:function(e,t,n){e.exports=n(94)}}]);